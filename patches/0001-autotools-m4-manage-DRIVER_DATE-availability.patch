From 6a2ed9653926c9799549e792e0cd0d74a2cc97d9 Mon Sep 17 00:00:00 2001
From: Kanaka Raju Nayana <kanaka.raju.nayana@intel.com>
Date: Thu, 9 Oct 2025 12:25:03 +0530
Subject: [PATCH] autotools/m4: manage DRIVER_DATE availability

Add conditional support for drm_driver .date field which was removed
in 6.14 kernels but is required for 6.6 to show proper driver info
in dmesg instead of "(null)".

Uses m4 detection and BPM_DRV_DATE_NOT_PRESENT macro to conditionally
include the field only when supported by the target kernel.

Signed-off-by: Kanaka Raju Nayana <kanaka.raju.nayana@intel.com>
---
 drivers/gpu/drm/xe/xe_device.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/gpu/drm/xe/xe_device.c b/drivers/gpu/drm/xe/xe_device.c
index a3c37c0..5fbba27 100644
--- a/drivers/gpu/drm/xe/xe_device.c
+++ b/drivers/gpu/drm/xe/xe_device.c
@@ -300,6 +300,9 @@ static struct drm_driver driver = {
 	.fops = &xe_driver_fops,
 	.name = DRIVER_NAME,
 	.desc = DRIVER_DESC,
+#ifndef BPM_DRV_DATE_NOT_PRESENT
+	.date = DRIVER_DATE,
+#endif
 	.major = DRIVER_MAJOR,
 	.minor = DRIVER_MINOR,
 	.patchlevel = DRIVER_PATCHLEVEL,
-- 
2.43.0

